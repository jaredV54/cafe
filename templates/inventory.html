{% extends 'layout.html' %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/inventory.css') }}">

<section>
    <div class="manage-inventory">
    <form id="product-form" action="{{ url_for('add_product') }}" method="post">
        <h3 id="form-title">Add New Product</h3>
        
        <input type="hidden" name="product_id" id="product-id">

        <div>
            <label for="name">Name:</label>
            <input type="text" name="name" id="product-name" required>
        </div>
        
        <div>
            <label for="price">Price:</label>
            <input type="number" step="0.01" name="price" id="product-price" required>
        </div>
        
        <div>
            <label for="category">Category:</label>
            <select name="category" id="product-category" required>
                <option value="hot-coffee">Hot Coffee</option>
                <option value="cold-coffee">Cold Coffee</option>
                <option value="pastries">Pastries</option>
            </select>
        </div>

        <div>
            <label for="is_available">Available:</label>
            <input type="checkbox" checked name="is_available" id="product-available">
        </div>

        <div>
            <button type="button" id="cancel-button" style="display:none;">Cancel</button>
            <button type="submit" id="submit-button">Add Product</button>
        </div>
    </form>
    </div>

    <div>
        <div class="inventory">
            <div id="category-container">
                <ul class="categories">
                    <li class="{% if selected_category == 'all' %}active{% endif %}">
                        <a href="?category=all">All</a>
                    </li>
                    <li class="{% if selected_category == 'hot-coffee' %}active{% endif %}">
                        <a href="?category=hot-coffee">Hot Coffee</a>
                    </li>
                    <li class="{% if selected_category == 'cold-coffee' %}active{% endif %}">
                        <a href="?category=cold-coffee">Cold Coffee</a>
                    </li>
                    <li class="{% if selected_category == 'pastries' %}active{% endif %}">
                        <a href="?category=pastries">Pastries</a>
                    </li>
                </ul>
            </div>

            <div>
                <input type="text" name="search-bar" id="search-query" placeholder="Search for an item...">
            </div>
            
            <ul>
                {% for product in products %}
                    {% if product['name'] %}
                    <li 
                        class="product-item"
                        data-id="{{ product['id'] }}"
                        data-name="{{ product['name']|replace("'", "\\'")|replace('\\', '\\\\') }}"
                        data-price="{{ product['price'] }}"
                        data-category="{{ product['category']|replace("'", "\\'")|replace('\\', '\\\\') }}"
                        data-available="{{ 'true' if product['is_available'] else 'false' }}"
                        onclick="selectProduct(this)"
                    >
                        <h4>{{ product['name'] }}</h4>
                        <p>P{{ '%.2f'|format(product['price']) }}</p>
                        <p>{{ "Available" if product['is_available'] else "Unavailable" }}</p>
                        <form action="{{ url_for('delete_product', product_id=product['id']) }}" method="post">
                            <button type="submit" onclick="event.stopPropagation(); return confirm('Are you sure you want to delete this product?');">Delete</button>
                        </form>
                        <p>{{ product['category'] }}</p>
                    </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>
</section>

<script type="module" src="{{ url_for('static', filename='js/inventory.js') }}"></script>
{% endblock %}